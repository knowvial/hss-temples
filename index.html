<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>South Indian Temple Tour</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #8b4513;
            margin-bottom: 30px;
        }
        .temple-display {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .temple-image {
            width: 100%;
            height: auto;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .temple-info {
            margin-bottom: 20px;
        }
        .temple-name {
            font-size: 1.5rem;
            color: #8b4513;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .location {
            font-style: italic;
            color: #666;
            margin-bottom: 10px;
        }
        .description {
            line-height: 1.6;
        }
        .key-facts {
            background-color: #f9f5eb;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        .key-facts h3 {
            margin-top: 0;
            color: #8b4513;
        }
        .controls {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .presenter-controls {
            background-color: #f0f0f0;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 2px solid #8b4513;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .share-section {
            margin: 15px 0;
            padding: 10px;
            background-color: #fafafa;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .share-title {
            font-size: 1.2rem;
            color: #8b4513;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .btn {
            background-color: #8b4513;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background-color: #6d370f;
        }
        .btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .progress {
            text-align: center;
            margin-top: 20px;
            color: #666;
        }
        .hidden {
            display: none;
        }
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
        .waiting-screen {
            text-align: center;
            padding: 40px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-top: 50px;
        }
        .waiting-icon {
            font-size: 3rem;
            color: #8b4513;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        .mode-toggle {
            text-align: center;
            margin-bottom: 20px;
        }
        #presentation-url {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .copy-btn {
            margin-top: 10px;
            background-color: #4a6da7;
        }
        #qrcode {
            text-align: center;
            margin-top: 15px;
        }
        @media (max-width: 600px) {
            .temple-display {
                padding: 15px;
            }
            .btn {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .status-active {
            background-color: #4CAF50;
        }
        .status-waiting {
            background-color: #FF9800;
        }
        .session-info {
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        .animated-dots::after {
            content: '';
            animation: dots 1.5s infinite;
        }
        @keyframes dots {
            0% { content: '.'; }
            33% { content: '..'; }
            66% { content: '...'; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>South Indian Temple Tour</h1>
        
        <div id="main-content">
            <!-- Content will be dynamically inserted here -->
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script>
        // ====== Temple Data ======
        const temples = [
            {
                name: "Meenakshi Amman Temple",
                location: "Madurai, Tamil Nadu",
                image: "/api/placeholder/800/500", // Replace with actual image URL in a real implementation
                description: "The Meenakshi Amman Temple is dedicated to goddess Meenakshi (a form of Parvati) and her consort, Sundareshwar (a form of Shiva). This magnificent temple is known for its towering gopurams (gateway towers) adorned with thousands of colorful sculptures.",
                keyFacts: [
                    "Features 14 gateway towers ranging from 45-50 meters in height",
                    "The temple complex covers 45 acres",
                    "Has a sacred tank called the Golden Lotus Tank (Porthamarai Kulam)",
                    "The current structure dates mainly to the 16th-17th centuries"
                ]
            },
            {
                name: "Brihadeeswarar Temple",
                location: "Thanjavur, Tamil Nadu",
                image: "/api/placeholder/800/500",
                description: "Also known as Peruvudaiyar Kovil, this temple is dedicated to Lord Shiva and was built by Raja Raja Chola I in the 11th century. It's a UNESCO World Heritage Site and one of the largest temples in India.",
                keyFacts: [
                    "The main vimana (tower) stands at 216 feet (66 meters) tall",
                    "The temple is built entirely of granite with over 130,000 tons of granite used",
                    "The main lingam is one of the largest in India, standing about 3.7 meters tall",
                    "The temple's shadow never falls on the ground at noon"
                ]
            },
            {
                name: "Virupaksha Temple",
                location: "Hampi, Karnataka",
                image: "/api/placeholder/800/500",
                description: "Dedicated to Lord Virupaksha, a form of Shiva, this is the oldest and principal temple in Hampi. The temple continues to prosper as an important pilgrimage center even after the fall of the Vijayanagara Empire.",
                keyFacts: [
                    "Temple history dates back to the 7th century",
                    "The main gopuram stands 50 meters high",
                    "Features exquisite stone carvings and impressive pillared halls",
                    "Houses the shrine of Pampa, the local river goddess and consort of Virupaksha"
                ]
            },
            {
                name: "Ekambareswarar Temple",
                location: "Kanchipuram, Tamil Nadu",
                image: "/api/placeholder/800/500",
                description: "This temple is dedicated to Shiva as Ekambareswarar (Lord of the Single Mango Tree). It is one of the Pancha Bhoota Stalas representing the element Earth and is known for its 3,500-year-old mango tree.",
                keyFacts: [
                    "Features a 59-meter high gopuram, one of the tallest temple towers in South India",
                    "The temple complex covers 23 acres",
                    "Contains 1,000 lingam sculptures",
                    "The legendary mango tree is said to produce four different types of mangoes"
                ]
            },
            {
                name: "Annamalaiyar Temple",
                location: "Tiruvannamalai, Tamil Nadu",
                image: "/api/placeholder/800/500",
                description: "Dedicated to Lord Shiva, this temple represents the element fire among the Pancha Bhoota Stalas. The temple is associated with the sacred hill Arunachala, which is considered a manifestation of Shiva himself.",
                keyFacts: [
                    "The main gopuram is 217 feet (66 meters) high",
                    "The temple complex spans 25 acres",
                    "During the Karthigai Deepam festival, a huge lamp is lit atop the Arunachala Hill",
                    "The temple has been praised in the Tamil Tevaram hymns by saints Sambandar and Appar"
                ]
            },
            {
                name: "Ramanathaswamy Temple",
                location: "Rameswaram, Tamil Nadu",
                image: "/api/placeholder/800/500",
                description: "This temple is dedicated to Lord Shiva and is significant as one of the twelve Jyotirlinga shrines. According to legend, Lord Rama worshipped Shiva here to cleanse himself of the sin of killing Ravana.",
                keyFacts: [
                    "Features the longest corridor among all Hindu temples, with 1,212 pillars",
                    "Has 22 theerthams (holy water tanks) within the temple complex",
                    "The main shrine houses a lingam that was installed by Lord Rama himself",
                    "The temple's design follows Dravidian architecture with massive walls and gopurams"
                ]
            },
            {
                name: "Padmanabhaswamy Temple",
                location: "Thiruvananthapuram, Kerala",
                image: "/api/placeholder/800/500",
                description: "This temple is dedicated to Lord Vishnu in the form of Padmanabha (one who emerges from the lotus) reclining on the serpent Anantha. The temple gained international attention for its vast treasure discovered in sealed vaults.",
                keyFacts: [
                    "The main deity is a 18-foot-long Vishnu in Anantha Shayanam posture",
                    "The temple is built in a blend of Kerala and Dravidian architectural styles",
                    "It's one of the 108 sacred Vishnu temples or Divya Desams",
                    "The temple was controlled by the royal family of Travancore until recent times"
                ]
            }
        ];

        // ====== Application Variables ======
        let currentTempleIndex = 0;
        let isPresenterMode = false;
        let sessionId = null;
        
        // The presenter password - in a real application, this would be securely stored
        const PRESENTER_PASSWORD = "temple123"; // You can change this to any password you prefer
        
        // ====== Session Management ======
        // Generate a unique session ID
        function generateSessionId() {
            return 'session-' + Math.random().toString(36).substr(2, 9);
        }
        
        // Create a new presenter session
        function createPresenterSession() {
            sessionId = generateSessionId();
            const sessionData = {
                active: true,
                currentSlide: 0,
                lastUpdated: new Date().getTime()
            };
            localStorage.setItem('temple-session-' + sessionId, JSON.stringify(sessionData));
            return sessionId;
        }
        
        // Join existing session as viewer
        function joinSession(id) {
            // Try to get session data first before determining if it exists
            const sessionData = localStorage.getItem('temple-session-' + id);
            
            // For testing purposes, always allow connection even if session is not found yet
            // This helps when presenter hasn't fully initialized the session
            if (sessionData === null) {
                // Create a temporary placeholder for this session to avoid errors
                const tempData = {
                    active: true,
                    currentSlide: 0,
                    lastUpdated: new Date().getTime(),
                    pending: true  // Mark as pending until real data appears
                };
                localStorage.setItem('temple-session-' + id, JSON.stringify(tempData));
            }
            
            return true; // Always return true to allow connection attempt
        }
        
        // Update session data
        function updateSessionData(slideIndex) {
            if (sessionId && isPresenterMode) {
                const sessionData = {
                    active: true,
                    currentSlide: slideIndex,
                    lastUpdated: new Date().getTime()
                };
                localStorage.setItem('temple-session-' + sessionId, JSON.stringify(sessionData));
            }
        }
        
        // Get current session data
        function getSessionData(id) {
            const data = localStorage.getItem('temple-session-' + id);
            return data ? JSON.parse(data) : null;
        }
        
        // End session
        function endSession() {
            if (sessionId && isPresenterMode) {
                localStorage.removeItem('temple-session-' + sessionId);
                return true;
            }
            return false;
        }
        
        // ====== UI Functions ======
        // Show the current temple
        function showCurrentTemple() {
            const temple = temples[currentTempleIndex];
            const templeContainerEl = document.getElementById('temple-container');
            const currentIndexEl = document.getElementById('current-index');
            
            if (!templeContainerEl || !currentIndexEl) return;
            
            // Create temple display HTML
            let templeHTML = `
                <div class="temple-display">
                    <img src="${temple.image}" alt="${temple.name}" class="temple-image">
                    <div class="temple-info">
                        <div class="temple-name">${temple.name}</div>
                        <div class="location">${temple.location}</div>
                        <div class="description">${temple.description}</div>
                        <div class="key-facts">
                            <h3>Key Facts</h3>
                            <ul>
            `;
            
            // Add key facts to the HTML
            temple.keyFacts.forEach(fact => {
                templeHTML += `<li>${fact}</li>`;
            });
            
            templeHTML += `
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            
            // Update the DOM
            templeContainerEl.innerHTML = templeHTML;
            currentIndexEl.textContent = currentTempleIndex + 1;
            
            // Update navigation buttons
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            if (prevBtn && nextBtn) {
                prevBtn.disabled = currentTempleIndex === 0;
                nextBtn.disabled = currentTempleIndex === temples.length - 1;
            }
            
            // If in presenter mode, update the session data
            if (isPresenterMode) {
                updateSessionData(currentTempleIndex);
            }
        }
        
        // Poll for session updates
        function startPolling() {
            const pollInterval = setInterval(() => {
                if (!sessionId) {
                    clearInterval(pollInterval);
                    return;
                }
                
                const sessionData = getSessionData(sessionId);
                
                if (!sessionData) {
                    // No data yet, keep waiting
                    return;
                }
                
                if (!sessionData.active && !sessionData.pending) {
                    // Session ended
                    showSessionEndedMessage();
                    clearInterval(pollInterval);
                    return;
                }
                
                // Update slide if changed (and avoid updating if it's marked as pending)
                if (!sessionData.pending && sessionData.currentSlide !== currentTempleIndex) {
                    currentTempleIndex = sessionData.currentSlide;
                    showCurrentTemple();
                }
            }, 1000); // Poll every second
        }
        
        // Show streamlined waiting screen
        function showStreamlinedWaiting(sid) {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="waiting-screen">
                    <h2>Connecting to presentation...</h2>
                    <p class="animated-dots">Waiting for presenter</p>
                    <p>Session ID: ${sid}</p>
                </div>
            `;
            
            // Start polling for session to become available
            const waitInterval = setInterval(() => {
                const sessionData = getSessionData(sid);
                if (sessionData && !sessionData.pending) {
                    clearInterval(waitInterval);
                    window.location.reload(); // Simplest way to reconnect properly
                }
            }, 1500);
        }
        
        // Show simplified login screen
        function showSimplifiedLogin() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="login-container">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <button id="quick-presenter-btn" class="btn">Start as Presenter</button>
                    </div>
                    
                    <div style="text-align: center;">
                        <h3>Join Existing Presentation</h3>
                        <div class="form-group">
                            <input type="text" id="quick-session-input" placeholder="Enter session ID">
                        </div>
                        <button id="quick-join-btn" class="btn">Join</button>
                    </div>
                </div>
            `;
            
            // Add event listeners for new buttons
            setTimeout(() => {
                document.getElementById('quick-presenter-btn').addEventListener('click', () => {
                    const password = prompt("Enter presenter password:");
                    if (password === PRESENTER_PASSWORD) {
                        setupPresenterMode();
                        showPresentation();
                    } else {
                        alert("Incorrect password");
                    }
                });
                
                document.getElementById('quick-join-btn').addEventListener('click', () => {
                    const sid = document.getElementById('quick-session-input').value.trim();
                    if (sid) {
                        window.location.href = `${window.location.href.split('?')[0]}?session=${sid}&direct=true`;
                    } else {
                        alert("Please enter a session ID");
                    }
                });
                
                document.getElementById('quick-session-input').addEventListener('keyup', (e) => {
                    if (e.key === 'Enter') {
                        document.getElementById('quick-join-btn').click();
                    }
                });
            }, 100);
        }
        
        // Setup presenter mode
        function setupPresenterMode() {
            isPresenterMode = true;
            
            // Create a new session
            const newSessionId = createPresenterSession();
            sessionId = newSessionId;
            
            // Generate viewer direct URL
            const baseUrl = window.location.href.split('?')[0];
            const viewerUrl = `${baseUrl}?session=${newSessionId}&direct=true`;
            
            // Update interface for presenter view
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="presenter-controls">
                    <h3 style="color: #8b4513; text-align: center; margin-bottom: 20px;">Presenter Controls</h3>
                    
                    <div class="share-section">
                        <div class="share-title">Share with your audience:</div>
                        <p><strong>Session ID:</strong></p>
                        <input type="text" id="presentation-session-id" value="${newSessionId}" readonly style="font-weight: bold; font-size: 1.1rem;">
                        <button id="copy-session-btn" class="btn copy-btn">Copy Session ID</button>
                        
                        <p style="margin-top: 15px;"><strong>Direct Link:</strong></p>
                        <input type="text" id="presentation-url" value="${viewerUrl}" readonly>
                        <button id="copy-url-btn" class="btn copy-btn">Copy Link</button>
                        
                        <p style="margin-top: 15px;"><strong>QR Code:</strong></p>
                        <div id="qrcode" style="margin: 10px auto; text-align: center; background: white; padding: 10px; width: fit-content;"></div>
                    </div>
                    
                    <p style="margin-top: 15px;">Session Status: <span class="status-indicator status-active"></span> <strong>Active</strong></p>
                    <button id="end-session-btn" class="btn" style="background-color: #d9534f; margin-top: 10px;">End Session</button>
                </div>
                
                <div id="temple-container"></div>
                
                <div class="controls">
                    <button id="prev-btn" class="btn" disabled>Previous</button>
                    <button id="next-btn" class="btn">Next</button>
                </div>
                
                <div class="progress">
                    Temple <span id="current-index">1</span> of <span id="total-temples">${temples.length}</span>
                </div>
            `;
            
            // Regenerate the QR code
            setTimeout(() => {
                const qrcodeElement = document.getElementById('qrcode');
                if (qrcodeElement) {
                    new QRCode(qrcodeElement, {
                        text: viewerUrl,
                        width: 128,
                        height: 128
                    });
                }
                
                // Add event listeners for the controls
                document.getElementById('copy-session-btn').addEventListener('click', function() {
                    const sessionIdInput = document.getElementById('presentation-session-id');
                    sessionIdInput.select();
                    document.execCommand('copy');
                    this.textContent = 'Copied!';
                    setTimeout(() => {
                        this.textContent = 'Copy Session ID';
                    }, 2000);
                });
                
                document.getElementById('copy-url-btn').addEventListener('click', function() {
                    const urlInput = document.getElementById('presentation-url');
                    urlInput.select();
                    document.execCommand('copy');
                    this.textContent = 'Copied!';
                    setTimeout(() => {
                        this.textContent = 'Copy Link';
                    }, 2000);
                });
                
                document.getElementById('end-session-btn').addEventListener('click', function() {
                    if (confirm('Are you sure you want to end this presentation session?')) {
                        endSession();
                        alert('Session ended. All viewers will be disconnected.');
                        window.location.href = window.location.href.split('?')[0];
                    }
                });
                
                document.getElementById('prev-btn').addEventListener('click', function() {
                    if (currentTempleIndex > 0) {
                        currentTempleIndex--;
                        showCurrentTemple();
                    }
                });
                
                document.getElementById('next-btn').addEventListener('click', function() {
                    if (currentTempleIndex < temples.length - 1) {
                        currentTempleIndex++;
                        showCurrentTemple();
                    }
                });
                
                // Show the first temple
                showCurrentTemple();
            }, 100);
        }
        
        // Setup viewer mode
        function setupViewerMode() {
            isPresenterMode = false;
            startPolling();
        }
        
        // Show presentation for viewer
        function showPresentation() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div id="temple-container"></div>
                
                <div class="progress">
                    Temple <span id="current-index">1</span> of <span id="total-temples">${temples.length}</span>
                </div>
            `;
            
            // Show the temple based on current index
            showCurrentTemple();
        }
        
        // Show session ended message
        function showSessionEndedMessage() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="waiting-screen">
                    <div class="waiting-icon">⚠️</div>
                    <h2>Session Ended</h2>
                    <p>The presenter has ended this presentation session.</p>
                    <button id="return-home-btn" class="btn">Return to Home</button>
                </div>
            `;
            
            // Add event listener to return home button
            setTimeout(() => {
                document.getElementById('return-home-btn').addEventListener('click', () => {
                    window.location.href = window.location.href.split('?')[0];
                });
            }, 100);
        }
        
        // Initialize the application
        function initializeApp() {
            const urlParams = new URLSearchParams(window.location.search);
            const sessionParam = urlParams.get('session');
            const presenterParam = urlParams.get('presenter');
            
            // Direct presenter access with password in URL (for your personal use only)
            if (presenterParam === PRESENTER_PASSWORD) {
                setupPresenterMode();
                return;
            }
            
            if (sessionParam) {
                // Always try to join as viewer
                if (joinSession(sessionParam)) {
                    sessionId = sessionParam;
                    
                    // Check if session exists
                    const sessionData = getSessionData(sessionId);
                    if (sessionData && sessionData.active && !sessionData.pending) {
                        // Session exists and is active
                        currentTempleIndex = sessionData.currentSlide || 0;
                        setupViewerMode();
                        showPresentation();
                    } else {
                        // Session doesn't exist yet or is pending
                        showStreamlinedWaiting(sessionId);
                    }
                }
            } else {
                // Simplified login screen by default
                showSimplifiedLogin();
            }
        }
        
        // Run the application on page load
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
